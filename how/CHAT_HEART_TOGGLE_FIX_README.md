# ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Heart Toggle ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó

## ‡∏™‡∏£‡∏∏‡∏õ
‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏ã‡πâ‡∏≥‡πÑ‡∏°‡πà‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó ‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ reaction ‡πÉ‡∏ô backend ‡πÅ‡∏•‡∏∞ frontend

## ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö

### 1. ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏î‡∏¥‡∏°
- ‡∏Å‡∏î‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å: ‚úÖ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
- ‡∏Å‡∏î‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á: ‚ùå ‡πÑ‡∏°‡πà‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
- ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI: ‚ùå ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

### 2. ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ `action` ‡πÉ‡∏ô backend ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á frontend ‡πÅ‡∏•‡∏∞ backend ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô
- ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ `addReaction` ‡πÅ‡∏•‡∏∞ `removeReaction` ‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô

## ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Backend Server

**‡πÑ‡∏ü‡∏•‡πå:** `backend/server.js`

```javascript
// React ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
socket.on('react-message', async (data) => {
  try {
    const { messageId, userId, reactionType = 'heart', action = 'add' } = data;
    
    const message = await Message.findById(messageId);
    if (!message) {
      socket.emit('error', { message: 'Message not found' });
      return;
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
    const chatRoom = await ChatRoom.findById(message.chatRoom);
    if (!chatRoom.isMember(userId)) {
      socket.emit('error', { message: 'Unauthorized' });
      return;
    }

    // ‡πÉ‡∏ä‡πâ addReaction method ‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ toggle ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
    const hadReaction = message.hasUserReacted(userId);
    message.addReaction(userId, reactionType);
    await message.save();
    
    const hasReactionNow = message.hasUserReacted(userId);
    const currentReactionType = message.getUserReactionType(userId);
    const finalAction = hasReactionNow ? 'added' : 'removed';

    // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï reaction ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á
    io.to(message.chatRoom.toString()).emit('message-reaction-updated', {
      messageId: message._id,
      userId,
      reactionType: currentReactionType,
      hasReaction: hasReactionNow,
      stats: message.stats,
      action: finalAction
    });
    
  } catch (error) {
    console.error('Error reacting to message:', error);
    socket.emit('error', { message: 'Failed to react to message' });
  }
});
```

### 2. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Frontend Socket Handler

**‡πÑ‡∏ü‡∏•‡πå:** `frontend/src/components/RealTimeChat.jsx`

```javascript
// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï reaction
newSocket.on('message-reaction-updated', (data) => {
  setMessages(prev => prev.map(msg => {
    if (msg._id === data.messageId) {
      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï reactions array
      let updatedReactions = msg.reactions || [];
      
      if (data.action === 'removed') {
        // ‡∏•‡∏ö reaction ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ
        updatedReactions = updatedReactions.filter(
          reaction => !(reaction.user === data.userId && reaction.type === data.reactionType)
        );
      } else if (data.action === 'added') {
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° reaction ‡πÉ‡∏´‡∏°‡πà
        const existingIndex = updatedReactions.findIndex(
          reaction => reaction.user === data.userId && reaction.type === data.reactionType
        );
        
        if (existingIndex === -1) {
          // ‡πÄ‡∏û‡∏¥‡πà‡∏° reaction ‡πÉ‡∏´‡∏°‡πà
          updatedReactions.push({
            user: data.userId,
            type: data.reactionType,
            createdAt: new Date()
          });
        }
      }
      
      return {
        ...msg,
        reactions: updatedReactions,
        stats: data.stats
      };
    }
    return msg;
  }));
});
```

### 3. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô handleReactToMessage

```javascript
const handleReactToMessage = (messageId, reactionType = 'heart') => {
  if (!socket) return;

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏¢‡∏Å‡∏î reaction ‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  const message = messages.find(msg => msg._id === messageId);
  const hasReacted = message && message.reactions && message.reactions.some(
    reaction => reaction.user === currentUser._id && reaction.type === reactionType
  );
  
  // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á backend
  socket.emit('react-message', {
    messageId,
    userId: currentUser._id,
    reactionType,
    action: hasReacted ? 'remove' : 'add'
  });
};
```

## ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà

### 1. Backend Logic
- ‡πÉ‡∏ä‡πâ `addReaction` method ‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ toggle ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
- ‡∏™‡πà‡∏á `action` ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á frontend

### 2. Frontend Logic
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ `action` ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (`added`/`removed`)
- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

### 3. Message Model
- `addReaction` method ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ toggle ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢ react ‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡∏•‡∏ö‡∏≠‡∏≠‡∏Å
- ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢ react ‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà

## ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

### ‚úÖ ‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:
- **‡∏Å‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å**: ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡πÉ‡∏à
- **‡∏Å‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á**: ‚úÖ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏´‡∏±‡∏ß‡πÉ‡∏à
- **Visual Feedback**: ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- **Real-time**: ‚úÖ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
- **Toggle Logic**: ‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

### üéØ ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:
1. **‡∏Å‡∏î Like**: ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á, ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô "Liked"
2. **‡∏Å‡∏î‡∏ã‡πâ‡∏≥**: ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏ó‡∏≤, ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô "Like"
3. **‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Like**: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏£‡∏¥‡∏á
4. **Real-time**: ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

## ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### Backend
- `backend/server.js` - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á socket event handler

### Frontend
- `frontend/src/components/RealTimeChat.jsx` - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á socket handler ‡πÅ‡∏•‡∏∞‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô

## ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### 1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Toggle
- ‡∏Å‡∏î‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‚Üí ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°
- ‡∏Å‡∏î‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á ‚Üí ‡∏Ñ‡∏ß‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
- ‡∏Å‡∏î‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏° ‚Üí ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

### 2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Real-time
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ A ‡∏Å‡∏î‡∏´‡∏±‡∏ß‡πÉ‡∏à ‚Üí ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ B ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ A ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏´‡∏±‡∏ß‡πÉ‡∏à ‚Üí ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ B ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

### 3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö UI
- ‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô like ‡∏Ñ‡∏ß‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- Tooltip ‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°

## ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
- ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ `addReaction` method ‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ toggle ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ `removeReaction` ‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å
- ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á frontend ‡πÅ‡∏•‡∏∞ backend ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô
- `action` ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô `added` ‡∏´‡∏£‡∏∑‡∏≠ `removed`
